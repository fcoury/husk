---
import { Image } from 'astro:assets';
import logo from '../assets/logo.png';
import CodeBlock from './CodeBlock.astro';

const codeExample = `enum Result<T, E> {
    Ok(T),
    Err(E),
}

fn main() {
    let result = Result::Ok(42);
    match result {
        Result::Ok(n) => println!("Got: {}", n),
        Result::Err(e) => println!("Error: {}", e),
    }
}`;
---

<section
  id="hero"
  class="relative overflow-hidden pt-24 pb-12 lg:pt-28 lg:pb-16 bg-cream-50 dark:bg-surface-900"
>
  <!-- Background Pattern -->
  <div class="absolute inset-0 grain"></div>

  <!-- Decorative wheat grains - smaller and more subtle -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <svg class="absolute -top-10 -left-10 w-64 h-64 text-husk-300/30 dark:text-husk-700/15 animate-float" viewBox="0 0 200 200" fill="currentColor">
      <ellipse cx="100" cy="60" rx="25" ry="45" transform="rotate(-30 100 60)" />
      <ellipse cx="130" cy="90" rx="20" ry="40" transform="rotate(-15 130 90)" />
    </svg>
    <svg class="absolute -top-5 right-0 w-56 h-56 text-husk-400/20 dark:text-husk-600/10 animate-float delay-200" viewBox="0 0 200 200" fill="currentColor">
      <ellipse cx="100" cy="80" rx="30" ry="55" transform="rotate(25 100 80)" />
    </svg>
    <svg class="absolute bottom-0 -left-5 w-48 h-48 text-husk-300/25 dark:text-husk-700/10 animate-float delay-400" viewBox="0 0 200 200" fill="currentColor">
      <ellipse cx="100" cy="100" rx="28" ry="50" transform="rotate(-20 100 100)" />
    </svg>
  </div>

  <!-- Content -->
  <div class="relative z-10 max-w-7xl mx-auto px-6 sm:px-8 lg:px-12">
    <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 items-center">
      <!-- Left column - Text content -->
      <div class="text-center lg:text-left">
        <!-- Logo + Title inline -->
        <div class="flex items-center justify-center lg:justify-start gap-3 sm:gap-4 mb-4 sm:mb-6 opacity-0 animate-fade-in-up">
          <div class="relative">
            <Image
              src={logo}
              alt="Husk Logo"
              width={48}
              height={48}
              class="drop-shadow-lg sm:w-16 sm:h-16"
            />
            <div class="absolute inset-0 bg-husk-400/20 blur-2xl rounded-full scale-150"></div>
          </div>
          <h1 class="font-display text-4xl sm:text-5xl lg:text-6xl text-surface-900 dark:text-cream-50">
            Husk
          </h1>
        </div>

        <!-- Tagline as main headline -->
        <p class="text-xl sm:text-2xl lg:text-3xl font-display text-surface-800 dark:text-cream-100 mb-4 sm:mb-6 leading-snug opacity-0 animate-fade-in-up delay-100">
          A <span class="text-husk-600 dark:text-husk-400 font-medium">Rust-inspired</span> language
          for building <span class="text-husk-600 dark:text-husk-400 font-medium">type-safe</span> JavaScript.
        </p>

        <!-- Description -->
        <p class="text-base sm:text-lg text-surface-600 dark:text-cream-100/70 mb-6 sm:mb-8 leading-relaxed opacity-0 animate-fade-in-up delay-200">
          Pattern matching, algebraic data types, and strong static typing â€”
          compiling to clean, readable JS that runs everywhere.
        </p>

        <!-- CTA Buttons -->
        <div class="flex flex-col sm:flex-row items-center justify-center lg:justify-start gap-3 mb-6 sm:mb-8 opacity-0 animate-fade-in-up delay-300">
          <a href="/docs/index.html" class="btn-primary inline-flex items-center gap-2">
            Get Started
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </a>
          <a
            href="https://github.com/fcoury/husk"
            target="_blank"
            rel="noopener noreferrer"
            class="btn-secondary inline-flex items-center gap-2"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z" />
            </svg>
            GitHub
          </a>
        </div>

        <!-- Quick install -->
        <div class="opacity-0 animate-fade-in-up delay-400">
          <div class="inline-flex items-center gap-3 px-4 py-2.5 bg-surface-900 dark:bg-surface-800 rounded-lg font-mono text-sm text-cream-100">
            <span class="text-husk-400">$</span>
            <code>cargo install huskc</code>
            <button
              id="copy-install"
              class="p-1 hover:bg-surface-700 rounded transition-colors"
              aria-label="Copy to clipboard"
            >
              <svg class="copy-icon w-4 h-4 text-surface-400 hover:text-cream-100" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
              </svg>
              <svg class="check-icon hidden w-4 h-4 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M20 6L9 17l-5-5" />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Right column - Code example (hidden on mobile) -->
      <div class="hidden lg:block opacity-0 animate-fade-in-up delay-200">
        <CodeBlock code={codeExample} filename="main.hk" />
      </div>
    </div>
  </div>
</section>

<script>
  function setupCopyButton() {
    const copyBtn = document.getElementById('copy-install');
    if (!copyBtn) return;

    const copyIcon = copyBtn.querySelector('.copy-icon');
    const checkIcon = copyBtn.querySelector('.check-icon');

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText('cargo install huskc');

        // Show check icon
        copyIcon?.classList.add('hidden');
        checkIcon?.classList.remove('hidden');

        // Reset after 2 seconds
        setTimeout(() => {
          copyIcon?.classList.remove('hidden');
          checkIcon?.classList.add('hidden');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  }

  setupCopyButton();
  document.addEventListener('astro:after-swap', setupCopyButton);
</script>
