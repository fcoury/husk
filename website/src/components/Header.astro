---
import { Image } from 'astro:assets';
import logo from '../assets/logo-small.png';

const navLinks = [
  { href: '#features', label: 'Features' },
  { href: '#code', label: 'Examples' },
  { href: '#community', label: 'Community' },
  { href: '/docs/', label: 'Docs', external: true },
];
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
>
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <nav class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a
        href="/"
        class="flex items-center gap-3 group"
        aria-label="Husk home"
      >
        <div class="relative">
          <Image
            src={logo}
            alt="Husk Logo"
            width={44}
            height={44}
            class="transition-transform duration-300 group-hover:scale-110"
          />
          <div class="absolute inset-0 bg-husk-400/20 rounded-full blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        </div>
        <span class="font-display text-2xl font-normal tracking-tight text-surface-900 dark:text-cream-50">
          Husk
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-1">
        {navLinks.map((link) => (
          <a
            href={link.href}
            target={link.external ? '_blank' : undefined}
            rel={link.external ? 'noopener noreferrer' : undefined}
            class="relative px-4 py-2 text-sm font-medium text-surface-700 dark:text-cream-200 hover:text-surface-900 dark:hover:text-cream-50 transition-colors duration-200 group inline-flex items-center gap-1"
          >
            {link.label}
            {link.external && (
              <svg class="w-3 h-3 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
            )}
            <span class="absolute bottom-0 left-1/2 w-0 h-0.5 bg-husk-500 transition-all duration-300 group-hover:w-[calc(100%-2rem)] group-hover:left-4"></span>
          </a>
        ))}

        <!-- Theme Toggle -->
        <button
          id="theme-toggle"
          type="button"
          class="ml-4 p-2.5 rounded-lg bg-cream-200 dark:bg-surface-700 hover:bg-cream-300 dark:hover:bg-surface-600 transition-colors duration-200"
          aria-label="Toggle dark mode"
        >
          <svg class="sun-icon w-5 h-5 text-husk-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5" />
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
          </svg>
          <svg class="moon-icon hidden w-5 h-5 text-husk-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
          </svg>
        </button>

        <!-- GitHub Link -->
        <a
          href="https://github.com/fcoury/husk"
          target="_blank"
          rel="noopener noreferrer"
          class="ml-2 p-2.5 rounded-lg hover:bg-cream-200 dark:hover:bg-surface-700 transition-colors duration-200"
          aria-label="View on GitHub"
        >
          <svg class="w-5 h-5 text-surface-700 dark:text-cream-200" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z" />
          </svg>
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        type="button"
        class="md:hidden p-2.5 rounded-lg hover:bg-cream-200 dark:hover:bg-surface-700 transition-colors"
        aria-label="Open menu"
        aria-expanded="false"
      >
        <svg class="menu-icon w-6 h-6 text-surface-700 dark:text-cream-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg class="close-icon hidden w-6 h-6 text-surface-700 dark:text-cream-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </nav>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="hidden md:hidden absolute top-full left-0 right-0 bg-cream-50/95 dark:bg-surface-900/95 backdrop-blur-lg border-b border-cream-200 dark:border-surface-700"
  >
    <div class="px-4 py-6 space-y-4">
      {navLinks.map((link) => (
        <a
          href={link.href}
          target={link.external ? '_blank' : undefined}
          rel={link.external ? 'noopener noreferrer' : undefined}
          class="flex items-center gap-2 py-3 px-4 text-lg font-medium text-surface-700 dark:text-cream-200 hover:text-husk-600 dark:hover:text-husk-400 hover:bg-cream-100 dark:hover:bg-surface-800 rounded-lg transition-colors"
        >
          {link.label}
          {link.external && (
            <svg class="w-4 h-4 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          )}
        </a>
      ))}

      <div class="flex items-center gap-4 pt-4 border-t border-cream-200 dark:border-surface-700">
        <!-- Mobile Theme Toggle -->
        <button
          id="mobile-theme-toggle"
          type="button"
          class="flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-lg bg-cream-200 dark:bg-surface-700 text-surface-700 dark:text-cream-200"
        >
          <svg class="mobile-sun-icon w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5" />
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
          </svg>
          <svg class="mobile-moon-icon hidden w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
          </svg>
          <span class="theme-label">Light</span>
        </button>

        <!-- Mobile GitHub -->
        <a
          href="https://github.com/fcoury/husk"
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center justify-center gap-2 py-3 px-4 rounded-lg bg-surface-900 dark:bg-cream-50 text-cream-50 dark:text-surface-900"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z" />
          </svg>
          GitHub
        </a>
      </div>
    </div>
  </div>
</header>

<!-- Header scroll behavior and mobile menu -->
<script>
  function setupHeader() {
    const header = document.getElementById('header');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = mobileMenuBtn?.querySelector('.menu-icon');
    const closeIcon = mobileMenuBtn?.querySelector('.close-icon');
    const mobileThemeToggle = document.getElementById('mobile-theme-toggle');

    let lastScrollY = 0;
    let isMenuOpen = false;

    // Scroll behavior
    function handleScroll() {
      if (!header) return;

      const scrollY = window.scrollY;

      if (scrollY > 50) {
        header.classList.add('bg-cream-50/90', 'dark:bg-surface-900/90', 'backdrop-blur-lg', 'shadow-sm');
      } else {
        header.classList.remove('bg-cream-50/90', 'dark:bg-surface-900/90', 'backdrop-blur-lg', 'shadow-sm');
      }

      lastScrollY = scrollY;
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      isMenuOpen = !isMenuOpen;
      mobileMenu?.classList.toggle('hidden', !isMenuOpen);
      menuIcon?.classList.toggle('hidden', isMenuOpen);
      closeIcon?.classList.toggle('hidden', !isMenuOpen);
      mobileMenuBtn?.setAttribute('aria-expanded', String(isMenuOpen));
    }

    // Mobile theme toggle
    function handleMobileThemeToggle() {
      const html = document.documentElement;
      html.classList.toggle('dark');
      const isDark = html.classList.contains('dark');
      localStorage.setItem('husk-theme', isDark ? 'dark' : 'light');
      updateMobileThemeUI();

      // Also update desktop toggle
      const desktopSun = document.querySelector('#theme-toggle .sun-icon');
      const desktopMoon = document.querySelector('#theme-toggle .moon-icon');
      if (desktopSun && desktopMoon) {
        desktopSun.classList.toggle('hidden', isDark);
        desktopMoon.classList.toggle('hidden', !isDark);
      }
    }

    function updateMobileThemeUI() {
      const isDark = document.documentElement.classList.contains('dark');
      const sunIcon = mobileThemeToggle?.querySelector('.mobile-sun-icon');
      const moonIcon = mobileThemeToggle?.querySelector('.mobile-moon-icon');
      const label = mobileThemeToggle?.querySelector('.theme-label');

      if (sunIcon && moonIcon && label) {
        sunIcon.classList.toggle('hidden', isDark);
        moonIcon.classList.toggle('hidden', !isDark);
        label.textContent = isDark ? 'Dark' : 'Light';
      }
    }

    // Close menu when clicking a link
    mobileMenu?.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        if (isMenuOpen) toggleMobileMenu();
      });
    });

    // Event listeners
    window.addEventListener('scroll', handleScroll, { passive: true });
    mobileMenuBtn?.addEventListener('click', toggleMobileMenu);
    mobileThemeToggle?.addEventListener('click', handleMobileThemeToggle);

    // Initial state
    handleScroll();
    updateMobileThemeUI();
  }

  setupHeader();
  document.addEventListener('astro:after-swap', setupHeader);
</script>

<style>
  /* Ensure smooth transitions on header */
  #header {
    transition: background-color 0.3s ease, backdrop-filter 0.3s ease, box-shadow 0.3s ease;
  }
</style>
