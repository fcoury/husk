# Husk npm Demo

A comprehensive demonstration of Husk language features integrated with real npm packages.

## Features Demonstrated

- **Multi-file modules**: `use crate::types::User`
- **Structs**: `User` with multiple fields
- **Enums**: `ValidationError` with multiple variants
- **Pattern matching**: On `Result` and custom enums
- **Extern FFI**: Declaring and calling JavaScript functions
- **String operations**: Concatenation with `+`

## npm Packages Used

- **chalk** (v4.x): Terminal colors and styling
- **nanoid** (v3.x): Unique ID generation
- **validator** (v13.x): String validation (email, alpha, length)

## Quick Start

```bash
# From the demo_npm directory
cd examples/demo_npm

# 1. Install npm dependencies
npm install

# 2. Build the Husk code
npm run build   # or: huskc build

# 3. Run the demo
npm start       # or: node host.js
```

## Expected Output

```
=== Husk npm Demo ===

Creating user: Alice, alice@example.com
User created successfully!
  ID:    V1StGXR8_Z5jdHi6B-myT
  Name:  Alice
  Email: alice@example.com

Creating user: Bob, not-an-email
Error: Invalid email address

Creating user: Alice123, alice@test.com
Error: Name must contain only letters

Creating user: (empty), test@test.com
Error: Field cannot be empty

=== Demo Complete ===
```

(IDs will vary as they are randomly generated)

## File Structure

```
demo_npm/
├── main.hk       # Main application with validation logic
├── types.hk      # Type definitions (User, ValidationError)
├── host.js       # Node.js host that wires npm packages
├── dist/         # Build output (generated by huskc build)
│   ├── main.js
│   └── main.js.map
├── package.json  # npm dependencies and scripts
└── README.md     # This file
```

## How It Works

1. **types.hk** defines the data types used by the application
2. **main.hk** imports types and declares extern functions for npm packages
3. **huskc build** compiles the Husk code to `dist/main.js`
4. **host.js** loads npm packages, exposes them via `globalThis`, and imports the compiled code
5. The compiled Husk code calls `main()` automatically on import

## Architecture Notes

This demo uses the "host pattern" where a JavaScript file:
1. Imports npm packages
2. Exposes functions via `globalThis`
3. Dynamically imports the compiled Husk code

This pattern is needed because Husk's `extern "js" { fn name(); }` syntax generates
`globalThis.name()` calls, which requires a host to wire up the actual npm package
functions.

For simple projects without npm dependencies, you can use `huskc run` directly.
